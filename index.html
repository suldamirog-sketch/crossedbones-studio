<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WIHB Pro Generator</title>
    <link rel="icon" type="image/png" href="/mnt/user-data/uploads/logo_wei.png">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@700&family=Russo+One&family=Teko:wght@700&family=Anton&family=Black+Ops+One&family=Permanent+Marker&family=Righteous&family=Staatliches&family=Passion+One:wght@700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 38px;
            background: linear-gradient(135deg, #ff0000, #ffffff, #ff0000);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(255, 0, 0, 0.3);
            font-weight: 900;
            letter-spacing: 3px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 20px;
        }

        .controls-panel {
            background: linear-gradient(135deg, #1a1a1a, #0f0f0f);
            padding: 20px;
            border-radius: 15px;
            height: fit-content;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid #2a2a2a;
            box-shadow: 0 10px 40px rgba(255, 0, 0, 0.1);
        }

        .controls-panel::-webkit-scrollbar {
            width: 8px;
        }

        .controls-panel::-webkit-scrollbar-track {
            background: #0a0a0a;
            border-radius: 10px;
        }

        .controls-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #ff0000, #cc0000);
            border-radius: 10px;
        }

        .controls-panel::-webkit-scrollbar-thumb:hover {
            background: #ff0000;
        }

        .section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #2a2a2a;
        }

        .section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: #ff0000;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
        }

        .control-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #aaa;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px;
            background: #0f0f0f;
            border: 2px solid #2a2a2a;
            border-radius: 6px;
            color: #fff;
            font-size: 14px;
            transition: all 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #ff0000;
            background: #1a1a1a;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.2);
        }

        input[type="color"] {
            width: 100%;
            height: 45px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        input[type="file"] {
            width: 100%;
            padding: 8px;
            background: #0f0f0f;
            border: 2px dashed #2a2a2a;
            border-radius: 6px;
            cursor: pointer;
            color: #999;
            font-size: 12px;
            transition: all 0.3s;
        }

        input[type="file"]:hover {
            border-color: #ff0000;
            background: #1a1a1a;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            background: #2a2a2a;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: linear-gradient(135deg, #ff0000, #cc0000);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: #ff0000;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.8);
        }

        .range-value {
            display: inline-block;
            float: right;
            color: #ff0000;
            font-weight: 700;
            font-size: 12px;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .preset-btn {
            padding: 10px;
            background: linear-gradient(135deg, #1a1a1a, #0f0f0f);
            border: 2px solid #2a2a2a;
            border-radius: 6px;
            color: #fff;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .preset-btn:hover {
            border-color: #ff0000;
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.2);
        }

        .action-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #ff0000, #cc0000);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
            box-shadow: 0 5px 20px rgba(255, 0, 0, 0.3);
        }

        .action-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 0, 0, 0.5);
            background: linear-gradient(135deg, #ff1a1a, #dd0000);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
            border: 2px solid #ff0000;
            box-shadow: 0 5px 20px rgba(255, 0, 0, 0.2);
        }

        .action-btn.secondary:hover:not(:disabled) {
            background: linear-gradient(135deg, #3a3a3a, #2a2a2a);
        }

        .canvas-container {
            background: linear-gradient(135deg, #1a1a1a, #0f0f0f);
            padding: 20px;
            border-radius: 15px;
            position: relative;
            border: 1px solid #2a2a2a;
            box-shadow: 0 10px 40px rgba(255, 0, 0, 0.1);
        }

        #renderCanvas {
            width: 100%;
            max-width: 1280px;
            height: auto;
            display: block;
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
            border: 2px solid #2a2a2a;
        }

        .audio-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            align-items: center;
        }

        .play-btn {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ff0000, #cc0000);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3);
        }

        .play-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 25px rgba(255, 0, 0, 0.5);
        }

        .audio-time {
            flex: 1;
            background: #0f0f0f;
            padding: 10px 15px;
            border-radius: 8px;
            font-family: monospace;
            text-align: center;
            border: 2px solid #2a2a2a;
        }

        .status-message {
            margin-top: 10px;
            padding: 12px;
            background: #0f0f0f;
            border-radius: 6px;
            text-align: center;
            font-size: 13px;
            color: #999;
            border-left: 4px solid #ff0000;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            color: #fff;
            font-size: 14px;
        }

        .tips {
            background: #0f0f0f;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #ff0000;
            border: 1px solid #2a2a2a;
        }

        .tips h4 {
            color: #ff0000;
            margin-bottom: 8px;
            font-size: 14px;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
        }

        .tips ul {
            list-style: none;
            padding: 0;
        }

        .tips li {
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
            padding-left: 15px;
            position: relative;
        }

        .tips li:before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: #ff0000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• WIHB PRO - Thumbnail & Video Generator</h1>
        > <img src="logo_wei.png" alt="wahllaichhabbock">
        <div class="main-grid">
            <!-- Controls Panel -->
            <div class="controls-panel">
                <!-- Text Section -->
                <div class="section">
                    <div class="section-title">üìù Text Einstellungen</div>
                    
                    <div class="control-group">
                        <label>Haupttext (Zeile 1)</label>
                        <input type="text" id="text1" value="DRILL" maxlength="25">
                    </div>
                    
                    <div class="control-group">
                        <label>Subtext (Zeile 2)</label>
                        <input type="text" id="text2" value="BALKAN" maxlength="25">
                    </div>
                    
                    <div class="control-group">
                        <label>Schriftart Haupttext</label>
                        <select id="font1">
                            <option value="'Anton', sans-serif">Anton (Standard)</option>
                            <option value="'Bebas Neue', sans-serif">Bebas Neue</option>
                            <option value="'Oswald', sans-serif">Oswald</option>
                            <option value="'Russo One', sans-serif">Russo One</option>
                            <option value="'Teko', sans-serif">Teko</option>
                            <option value="'Black Ops One', sans-serif">Black Ops One</option>
                            <option value="'Permanent Marker', sans-serif">Permanent Marker</option>
                            <option value="'Righteous', sans-serif">Righteous</option>
                            <option value="'Staatliches', sans-serif">Staatliches</option>
                            <option value="'Passion One', sans-serif">Passion One</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>Schriftart Subtext</label>
                        <select id="font2">
                            <option value="'Anton', sans-serif">Anton (Standard)</option>
                            <option value="'Bebas Neue', sans-serif">Bebas Neue</option>
                            <option value="'Oswald', sans-serif">Oswald</option>
                            <option value="'Russo One', sans-serif">Russo One</option>
                            <option value="'Teko', sans-serif">Teko</option>
                            <option value="'Black Ops One', sans-serif">Black Ops One</option>
                            <option value="'Permanent Marker', sans-serif">Permanent Marker</option>
                            <option value="'Righteous', sans-serif">Righteous</option>
                            <option value="'Staatliches', sans-serif">Staatliches</option>
                            <option value="'Passion One', sans-serif">Passion One</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>Haupttext Farbe</label>
                        <input type="color" id="textColor1" value="#ffffff">
                    </div>
                    
                    <div class="control-group">
                        <label>Subtext Farbe</label>
                        <input type="color" id="textColor2" value="#ffffff">
                    </div>
                </div>

                <!-- Colors Section -->
                <div class="section">
                    <div class="section-title">üé® Farben</div>
                    
                    <div class="control-group">
                        <label>Glow Farbe 1</label>
                        <input type="color" id="color1" value="#ff0844">
                    </div>
                    
                    <div class="control-group">
                        <label>Glow Farbe 2</label>
                        <input type="color" id="color2" value="#00d4ff">
                    </div>
                </div>

                <!-- Media Section -->
                <div class="section">
                    <div class="section-title">üñºÔ∏è Medien</div>
                    
                    <div class="control-group">
                        <label>Hintergrund (Bild/Video/GIF)</label>
                        <input type="file" id="bgImage" accept="image/*,video/*,.gif">
                    </div>
                    
                    <div class="control-group">
                        <label>Blur-St√§rke <span class="range-value" id="blurValue">0px</span></label>
                        <input type="range" id="blur" min="0" max="20" value="0">
                    </div>
                    
                    <div class="control-group">
                        <label>Helligkeit <span class="range-value" id="brightnessValue">40%</span></label>
                        <input type="range" id="brightness" min="0" max="100" value="40">
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="showLogo" checked>
                        <label for="showLogo">Logo anzeigen</label>
                    </div>
                    
                    <div class="control-group">
                        <label>Eigenes Logo</label>
                        <input type="file" id="logoFile" accept="image/*">
                    </div>
                </div>

                <!-- Audio Section -->
                <div class="section">
                    <div class="section-title">üéµ Audio & Effekte</div>
                    
                    <div class="control-group">
                        <label>Musik hochladen (.mp3, .wav)</label>
                        <input type="file" id="audioFile" accept="audio/*">
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="enableReactive">
                        <label for="enableReactive">Audio-Reaktive Effekte aktivieren</label>
                    </div>
                    
                    <div class="control-group">
                        <label>Reaktions-Intensit√§t <span class="range-value" id="intensityValue">50%</span></label>
                        <input type="range" id="intensity" min="0" max="100" value="50">
                    </div>
                    
                    <div class="control-group">
                        <label>Text-Effekt</label>
                        <select id="effectType">
                            <option value="pulse">Puls (Text)</option>
                            <option value="glow">Glow-Explosion</option>
                            <option value="shake">Shake</option>
                            <option value="scale">Gr√∂√üen-Puls</option>
                            <option value="all">Alle kombiniert</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>Visuelle Effekte</label>
                        <select id="visualEffect">
                            <option value="none">Keine</option>
                            <option value="particles">Partikel</option>
                            <option value="waves">Wellen</option>
                            <option value="lightning">Blitze</option>
                            <option value="fire">Feuer-Partikel</option>
                            <option value="all">Alle kombiniert</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>Partikel-Anzahl <span class="range-value" id="particleCountValue">50</span></label>
                        <input type="range" id="particleCount" min="10" max="200" value="50">
                    </div>
                </div>

                <!-- Other Settings -->
                <div class="section">
                    <div class="section-title">‚öôÔ∏è Weitere Einstellungen</div>
                    
                    <div class="control-group">
                        <label>Badge Text</label>
                        <input type="text" id="badge" value="FREE" maxlength="10">
                    </div>
                    
                    <div class="control-group">
                        <label>Badge Text Farbe</label>
                        <input type="color" id="badgeColor" value="#ffffff">
                    </div>
                    
                    <div class="control-group">
                        <label>BPM</label>
                        <input type="number" id="bpm" value="140" min="60" max="200">
                    </div>
                    
                    <div class="control-group">
                        <label>BPM Text Farbe</label>
                        <input type="color" id="bpmTextColor" value="#ffffff">
                    </div>
                    
                    <div class="control-group">
                        <label>BPM Glow Farbe</label>
                        <input type="color" id="bpmColor" value="#ff0844">
                    </div>
                    
                    <div class="control-group">
                        <label>Jahr</label>
                        <input type="number" id="year" value="2025" min="2020" max="2030">
                    </div>
                    
                    <div class="control-group">
                        <label>Jahr Text Farbe</label>
                        <input type="color" id="yearTextColor" value="#ffffff">
                    </div>
                    
                    <div class="control-group">
                        <label>Jahr Glow Farbe</label>
                        <input type="color" id="yearColor" value="#00d4ff">
                    </div>
                    
                    <div class="control-group">
                        <label>Producer Name (PROD BY ...)</label>
                        <input type="text" id="producerName" value="" placeholder="Dein Name" maxlength="20">
                    </div>
                    
                    <div class="control-group">
                        <label>Producer Text Farbe</label>
                        <input type="color" id="producerTextColor" value="#ffffff">
                    </div>
                    
                    <div class="control-group">
                        <label>Producer Glow Farbe</label>
                        <input type="color" id="producerColor" value="#00d4ff">
                    </div>
                </div>

                <!-- Presets -->
                <div class="section">
                    <div class="section-title">üé® Presets</div>
                    <div class="preset-grid">
                        <button class="preset-btn" onclick="applyPreset('drill')">üî• Drill</button>
                        <button class="preset-btn" onclick="applyPreset('trap')">üíé Trap</button>
                        <button class="preset-btn" onclick="applyPreset('melodic')">üåô Melodic</button>
                        <button class="preset-btn" onclick="applyPreset('aggressive')">‚ö° Aggressive</button>
                        <button class="preset-btn" onclick="applyPreset('balkan')">üá∑üá∏ Balkan</button>
                        <button class="preset-btn" onclick="applyPreset('dark')">üñ§ Dark</button>
                    </div>
                </div>

                <!-- Actions -->
                <div class="section">
                    <div class="section-title">üíæ Export</div>
                    <button class="action-btn" onclick="downloadImage()">üì∏ Als PNG speichern</button>
                    <button class="action-btn secondary" onclick="recordVideo()" id="recordBtn">üé¨ Als MP4 aufnehmen (mit Audio)</button>
                    <div id="statusMsg" class="status-message" style="display: none;"></div>
                </div>

                <!-- Tips -->
                <div class="tips">
                    <h4>üí° Tipps</h4>
                    <ul>
                        <li>Video/GIF Hintergr√ºnde f√ºr dynamische Effekte</li>
                        <li>Musik hochladen f√ºr Bass-reaktive Effekte</li>
                        <li>MP4 nimmt Audio + Video auf</li>
                        <li>Verschiedene Fonts f√ºr unique Styles</li>
                        <li>Jahr ist editierbar f√ºr zeitlose Designs</li>
                        <li>"Alle kombiniert" Effekt = Maximum Impact! üî•</li>
                    </ul>
                </div>
            </div>

            <!-- Canvas Display -->
            <div class="canvas-container">
                <canvas id="renderCanvas" width="1280" height="720"></canvas>
                
                <div class="audio-controls" id="audioControls" style="display: none;">
                    <button class="play-btn" id="playBtn" onclick="toggleAudio()">‚ñ∂</button>
                    <div class="audio-time">
                        <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <audio id="audioElement" style="display: none;"></audio>

    <script>
        // Canvas setup
        const canvas = document.getElementById('renderCanvas');
        const ctx = canvas.getContext('2d');
        
        // Audio setup
        const audioElement = document.getElementById('audioElement');
        let audioContext = null;
        let analyser = null;
        let bufferLength = 0;
        let dataArray = null;
        
        let audioSource = null;
        let isPlaying = false;
        let mediaRecorder = null;
        let recordedChunks = [];
        let audioInitialized = false;
        
        // State
        const state = {
            text1: 'DRILL',
            text2: 'BALKAN',
            font1: "'Anton', sans-serif",
            font2: "'Anton', sans-serif",
            textColor1: '#ffffff',
            textColor2: '#ffffff',
            color1: '#ff0844',
            color2: '#00d4ff',
            badge: 'FREE',
            badgeColor: '#ffffff',
            bpm: 140,
            bpmTextColor: '#ffffff',
            bpmColor: '#ff0844',
            bpmBgColor: 'rgba(0, 0, 0, 0.7)',
            year: 2025,
            yearTextColor: '#ffffff',
            yearColor: '#00d4ff',
            yearBgColor: 'rgba(0, 0, 0, 0.7)',
            producerName: '',
            producerTextColor: '#ffffff',
            producerColor: '#00d4ff',
            producerBgColor: 'rgba(0, 0, 0, 0.7)',
            blur: 0,
            brightness: 40,
            bgImage: null,
            bgVideo: null,
            logo: null,
            showLogo: true,
            enableReactive: false,
            intensity: 50,
            effectType: 'pulse',
            visualEffect: 'none',
            particleCount: 50
        };

        // Particle system
        let particles = [];
        
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 5;
                this.vy = (Math.random() - 0.5) * 5;
                this.life = 1;
                this.decay = Math.random() * 0.02 + 0.005;
                this.size = Math.random() * 4 + 2;
                this.color = color;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.1; // Gravity
                this.life -= this.decay;
            }
            
            draw(ctx) {
                ctx.save();
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        // Load default logo
        const defaultLogo = new Image();
        defaultLogo.src = '/mnt/user-data/uploads/logo_wei.png';
        defaultLogo.onload = () => {
            state.logo = defaultLogo;
            render();
        };

        // Event Listeners
        document.getElementById('text1').addEventListener('input', (e) => {
            state.text1 = e.target.value.toUpperCase();
            render();
        });

        document.getElementById('text2').addEventListener('input', (e) => {
            state.text2 = e.target.value.toUpperCase();
            render();
        });

        document.getElementById('font1').addEventListener('change', (e) => {
            state.font1 = e.target.value;
            render();
        });

        document.getElementById('font2').addEventListener('change', (e) => {
            state.font2 = e.target.value;
            render();
        });

        document.getElementById('textColor1').addEventListener('input', (e) => {
            state.textColor1 = e.target.value;
            render();
        });

        document.getElementById('textColor2').addEventListener('input', (e) => {
            state.textColor2 = e.target.value;
            render();
        });

        document.getElementById('color1').addEventListener('input', (e) => {
            state.color1 = e.target.value;
            render();
        });

        document.getElementById('color2').addEventListener('input', (e) => {
            state.color2 = e.target.value;
            render();
        });

        document.getElementById('badge').addEventListener('input', (e) => {
            state.badge = e.target.value.toUpperCase();
            render();
        });

        document.getElementById('badgeColor').addEventListener('input', (e) => {
            state.badgeColor = e.target.value;
            render();
        });

        document.getElementById('bpm').addEventListener('input', (e) => {
            state.bpm = e.target.value;
            render();
        });

        document.getElementById('bpmTextColor').addEventListener('input', (e) => {
            state.bpmTextColor = e.target.value;
            render();
        });

        document.getElementById('bpmColor').addEventListener('input', (e) => {
            state.bpmColor = e.target.value;
            render();
        });

        document.getElementById('year').addEventListener('input', (e) => {
            state.year = e.target.value;
            render();
        });

        document.getElementById('yearTextColor').addEventListener('input', (e) => {
            state.yearTextColor = e.target.value;
            render();
        });

        document.getElementById('yearColor').addEventListener('input', (e) => {
            state.yearColor = e.target.value;
            render();
        });

        document.getElementById('producerName').addEventListener('input', (e) => {
            state.producerName = e.target.value;
            render();
        });

        document.getElementById('producerTextColor').addEventListener('input', (e) => {
            state.producerTextColor = e.target.value;
            render();
        });

        document.getElementById('producerColor').addEventListener('input', (e) => {
            state.producerColor = e.target.value;
            render();
        });

        document.getElementById('blur').addEventListener('input', (e) => {
            state.blur = e.target.value;
            document.getElementById('blurValue').textContent = e.target.value + 'px';
            render();
        });

        document.getElementById('brightness').addEventListener('input', (e) => {
            state.brightness = e.target.value;
            document.getElementById('brightnessValue').textContent = e.target.value + '%';
            render();
        });

        document.getElementById('showLogo').addEventListener('change', (e) => {
            state.showLogo = e.target.checked;
            render();
        });

        document.getElementById('enableReactive').addEventListener('change', (e) => {
            state.enableReactive = e.target.checked;
        });

        document.getElementById('intensity').addEventListener('input', (e) => {
            state.intensity = e.target.value;
            document.getElementById('intensityValue').textContent = e.target.value + '%';
        });

        document.getElementById('effectType').addEventListener('change', (e) => {
            state.effectType = e.target.value;
        });

        document.getElementById('visualEffect').addEventListener('change', (e) => {
            state.visualEffect = e.target.value;
            // Start rendering if visual effect is enabled
            if (state.visualEffect !== 'none' && !animationId) {
                render();
            }
        });

        document.getElementById('particleCount').addEventListener('input', (e) => {
            state.particleCount = e.target.value;
            document.getElementById('particleCountValue').textContent = e.target.value;
        });

        document.getElementById('bgImage').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const fileType = file.type;
                
                // Reset previous media
                state.bgImage = null;
                state.bgVideo = null;
                
                if (fileType.startsWith('video/') || file.name.toLowerCase().endsWith('.gif')) {
                    // Handle video or GIF
                    const video = document.createElement('video');
                    video.muted = true;
                    video.loop = true;
                    video.autoplay = true;
                    video.playsInline = true;
                    
                    const url = URL.createObjectURL(file);
                    video.src = url;
                    
                    video.onloadeddata = () => {
                        state.bgVideo = video;
                        video.play();
                        render();
                        showStatus('‚úÖ Video/GIF Hintergrund geladen!');
                    };
                } else {
                    // Handle image
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const img = new Image();
                        img.onload = () => {
                            state.bgImage = img;
                            render();
                            showStatus('‚úÖ Bild Hintergrund geladen!');
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            }
        });

        document.getElementById('logoFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        state.logo = img;
                        render();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('audioFile').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            try {
                // Create new audio context if not exists
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    analyser = audioContext.createAnalyser();
                    analyser.fftSize = 256;
                    bufferLength = analyser.frequencyBinCount;
                    dataArray = new Uint8Array(bufferLength);
                }
                
                // Reset audio element
                audioElement.pause();
                audioElement.currentTime = 0;
                isPlaying = false;
                document.getElementById('playBtn').textContent = '‚ñ∂';
                
                // Create URL and load
                const url = URL.createObjectURL(file);
                audioElement.src = url;
                
                // Wait for load
                await new Promise((resolve, reject) => {
                    audioElement.onloadedmetadata = resolve;
                    audioElement.onerror = reject;
                });
                
                // Setup audio source only once
                if (!audioInitialized) {
                    audioSource = audioContext.createMediaElementSource(audioElement);
                    audioSource.connect(analyser);
                    analyser.connect(audioContext.destination);
                    audioInitialized = true;
                }
                
                // Show controls
                document.getElementById('audioControls').style.display = 'flex';
                document.getElementById('duration').textContent = formatTime(audioElement.duration);
                document.getElementById('currentTime').textContent = '0:00';
                
                // Time update handler
                audioElement.ontimeupdate = () => {
                    document.getElementById('currentTime').textContent = formatTime(audioElement.currentTime);
                };
                
                // Ended handler
                audioElement.onended = () => {
                    isPlaying = false;
                    document.getElementById('playBtn').textContent = '‚ñ∂';
                    if (animationId) {
                        cancelAnimationFrame(animationId);
                        animationId = null;
                    }
                    render();
                };
                
                showStatus('‚úÖ Audio geladen! Dr√ºcke Play zum Abspielen');
                
            } catch (error) {
                console.error('Audio load error:', error);
                showStatus('‚ùå Fehler beim Laden der Audio-Datei. Bitte versuche eine andere Datei.');
            }
        });

        // Render function
        let animationId = null;
        let lastFrameTime = 0;
        const targetFPS = 30; // Lower FPS for better performance
        const frameDelay = 1000 / targetFPS;
        
        function render(timestamp) {
            // Handle initial call without timestamp
            if (!timestamp) timestamp = performance.now();
            
            // Throttle to target FPS
            if (timestamp - lastFrameTime < frameDelay) {
                if ((state.enableReactive && isPlaying) || state.bgVideo || state.visualEffect !== 'none') {
                    animationId = requestAnimationFrame(render);
                }
                return;
            }
            lastFrameTime = timestamp;
            // Clear canvas
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Background image or video
            const bgSource = state.bgVideo || state.bgImage;
            if (bgSource) {
                ctx.save();
                const brightnessValue = state.brightness / 100;
              const safeBlur = Math.min(state.blur, 5);
ctx.filter = `blur(${safeBlur}px) brightness(${brightnessValue})`;

                   
                } else {
                    ctx.filter = `brightness(${brightnessValue})`;
                }
                
                let sourceWidth, sourceHeight;
                if (state.bgVideo) {
                    sourceWidth = state.bgVideo.videoWidth;
                    sourceHeight = state.bgVideo.videoHeight;
                } else {
                    sourceWidth = state.bgImage.width;
                    sourceHeight = state.bgImage.height;
                }
                
                const imgRatio = sourceWidth / sourceHeight;
                const canvasRatio = canvas.width / canvas.height;
                let drawWidth, drawHeight, offsetX, offsetY;
                
                if (imgRatio > canvasRatio) {
                    drawHeight = canvas.height;
                    drawWidth = drawHeight * imgRatio;
                    offsetX = (canvas.width - drawWidth) / 2;
                    offsetY = 0;
                } else {
                    drawWidth = canvas.width;
                    drawHeight = drawWidth / imgRatio;
                    offsetX = 0;
                    offsetY = (canvas.height - drawHeight) / 2;
                }
                
                ctx.drawImage(bgSource, offsetX, offsetY, drawWidth, drawHeight);
                ctx.restore();
            }
            
            // Gradient overlay
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, state.color1 + '40');
            gradient.addColorStop(1, '#00000080');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Get audio data for reactive effects with improved bass detection
            let audioLevel = 0;
            let bassLevel = 0;
            if (state.enableReactive && isPlaying && analyser && dataArray) {
                analyser.getByteFrequencyData(dataArray);
                
                // Get bass frequencies (lower range for kicks/bass)
                const bassRange = Math.floor(bufferLength * 0.15); // First 15% for bass
                const bassData = Array.from(dataArray.slice(0, bassRange));
                const bassAverage = bassData.reduce((a, b) => a + b) / bassRange;
                bassLevel = (bassAverage / 255) * (state.intensity / 100) * 1.5;
                
                // Get overall level
                const average = dataArray.reduce((a, b) => a + b) / bufferLength;
                audioLevel = (average / 255) * (state.intensity / 100);
            }
            
            // Glowing orbs with bass reactivity
            drawOrb(100, 100, 400 + bassLevel * 200, state.color1, 0.4 + bassLevel * 0.4);
            drawOrb(1180, 620, 350 + bassLevel * 150, state.color2, 0.4 + bassLevel * 0.4);
            
            // Visual Effects
            if (state.visualEffect !== 'none') {
                drawVisualEffects(bassLevel, audioLevel);
            }
            
            // Update and draw particles (optimized)
            if (state.visualEffect === 'particles' || state.visualEffect === 'fire' || state.visualEffect === 'all') {
                // Create new particles based on bass (limited)
                if (bassLevel > 0.3 && particles.length < state.particleCount) {
                    const particlesToCreate = Math.min(Math.floor(bassLevel * 5), 10); // Max 10 per frame
                    for (let i = 0; i < particlesToCreate; i++) {
                        const x = canvas.width / 2 + (Math.random() - 0.5) * 400;
                        const y = canvas.height / 2 + (Math.random() - 0.5) * 200;
                        const color = Math.random() > 0.5 ? state.color1 : state.color2;
                        particles.push(new Particle(x, y, color));
                    }
                }
                
                // Update and draw particles (batch operations)
                particles = particles.filter(p => p.life > 0);
                particles.forEach(p => {
                    p.update();
                    p.draw(ctx);
                });
            }
            
            // Main text with improved bass reactivity
            let text1Size = 140;
            let text1Y = 280;
            let text1X = canvas.width / 2;
            
            if (state.enableReactive && bassLevel > 0) {
                if (state.effectType === 'scale' || state.effectType === 'all') {
                    text1Size += bassLevel * 60; // Bigger scale
                }
                if (state.effectType === 'shake' || state.effectType === 'all') {
                    text1X += (Math.random() - 0.5) * bassLevel * 50;
                    text1Y += (Math.random() - 0.5) * bassLevel * 50;
                }
            }
            
            ctx.save();
            ctx.font = `900 ${text1Size}px ${state.font1}`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // Text shadow with audio reactive glow
            const glowIntensity = state.enableReactive ? (40 + bassLevel * 100) : 40;
            ctx.shadowColor = state.color1;
            ctx.shadowBlur = glowIntensity;
            ctx.fillStyle = state.textColor1;
            ctx.fillText(state.text1, text1X, text1Y);
            
            // Additional glow layer
            if (state.effectType === 'glow' || state.effectType === 'all') {
                ctx.shadowBlur = glowIntensity * 2;
                ctx.globalAlpha = 0.5 + bassLevel * 0.8;
                ctx.fillText(state.text1, text1X, text1Y);
            }
            ctx.restore();
            
            // Subtext with improved bass reactivity
            let text2Size = 80;
            let text2Y = 420;
            let text2X = canvas.width / 2;
            
            if (state.enableReactive && bassLevel > 0) {
                if (state.effectType === 'scale' || state.effectType === 'all') {
                    text2Size += bassLevel * 45;
                }
                if (state.effectType === 'shake' || state.effectType === 'all') {
                    text2X += (Math.random() - 0.5) * bassLevel * 40;
                    text2Y += (Math.random() - 0.5) * bassLevel * 40;
                }
            }
            
            ctx.save();
            ctx.font = `900 ${text2Size}px ${state.font2}`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            const textGradient = ctx.createLinearGradient(0, text2Y - 50, 0, text2Y + 50);
            textGradient.addColorStop(0, state.color1);
            textGradient.addColorStop(1, state.color2);
            ctx.fillStyle = state.textColor2;
            ctx.shadowColor = state.color2;
            ctx.shadowBlur = 30 + bassLevel * 60;
            ctx.fillText(state.text2, text2X, text2Y);
            ctx.restore();
            
            // Logo
            if (state.showLogo && state.logo) {
                ctx.save();
                const logoSize = 180;
                const logoPadding = 40;
                
                // Logo background
                ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
                ctx.fillRect(logoPadding, canvas.height - logoSize - logoPadding, logoSize, logoSize);
                
                // Logo image
                const logoMargin = 20;
                ctx.drawImage(state.logo, 
                    logoPadding + logoMargin, 
                    canvas.height - logoSize - logoPadding + logoMargin, 
                    logoSize - logoMargin * 2, 
                    logoSize - logoMargin * 2
                );
                ctx.restore();
            }
            
            // Badge (top right, higher position)
            ctx.save();
            ctx.translate(1100, 50);
            ctx.rotate(-5 * Math.PI / 180);
            
            const badgeGradient = ctx.createLinearGradient(0, 0, 0, 60);
            badgeGradient.addColorStop(0, state.color1);
            badgeGradient.addColorStop(1, state.color2);
            ctx.fillStyle = badgeGradient;
            ctx.shadowColor = state.color1;
            ctx.shadowBlur = 30;
            ctx.fillRect(-80, -30, 160, 60);
            
            ctx.font = "900 42px 'Anton', sans-serif";
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = state.badgeColor || '#ffffff';
            ctx.shadowBlur = 0;
            ctx.fillText(state.badge, 0, 0);
            ctx.restore();
            
            // Year (top left corner, separate)
            ctx.save();
            ctx.font = "900 48px 'Anton', sans-serif";
            ctx.textAlign = 'left';
            ctx.textBaseline = 'top';
            
            ctx.fillStyle = state.yearBgColor || 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(40, 40, 140, 60);
            
            ctx.shadowColor = state.yearColor || state.color2;
            ctx.shadowBlur = 15;
            ctx.fillStyle = state.yearTextColor || '#ffffff';
            ctx.fillText(state.year, 60, 55);
            ctx.restore();
            
            // BPM and Year
            ctx.save();
            ctx.font = "900 36px 'Anton', sans-serif";
            ctx.fillStyle = '#ffffff';
            ctx.shadowColor = state.color1;
            ctx.shadowBlur = 15;
            
            // BPM (bottom right)
            ctx.save();
            ctx.font = "900 36px 'Anton', sans-serif";
            ctx.textAlign = 'right';
            ctx.textBaseline = 'bottom';
            
            const bpmText = state.bpm + ' BPM';
            const bpmWidth = ctx.measureText(bpmText).width + 40;
            
            ctx.fillStyle = state.bpmBgColor || 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(1240 - bpmWidth, 640, bpmWidth, 50);
            
            ctx.shadowColor = state.bpmColor || state.color1;
            ctx.shadowBlur = 15;
            ctx.fillStyle = state.bpmTextColor || '#ffffff';
            ctx.fillText(bpmText, 1220, 675);
            ctx.restore();
            
            // Producer Name (bottom center)
            if (state.producerName && state.producerName.trim() !== '') {
                ctx.save();
                ctx.font = "700 32px 'Anton', sans-serif";
                ctx.textAlign = 'center';
                ctx.textBaseline = 'bottom';
                
                const prodText = 'PROD BY ' + state.producerName.toUpperCase();
                const prodWidth = ctx.measureText(prodText).width + 60;
                
                ctx.fillStyle = state.producerBgColor || 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect((canvas.width - prodWidth) / 2, 640, prodWidth, 50);
                
                ctx.shadowColor = state.producerColor || state.color2;
                ctx.shadowBlur = 15;
                ctx.fillStyle = state.producerTextColor || '#ffffff';
                ctx.fillText(prodText, canvas.width / 2, 675);
                ctx.restore();
            }
            
            // Continue animation if audio is playing and reactive mode is on, OR if video background is playing, OR if visual effects are enabled
            if ((state.enableReactive && isPlaying) || state.bgVideo || state.visualEffect !== 'none') {
                animationId = requestAnimationFrame(render);
            }
        }

        function drawVisualEffects(bassLevel, audioLevel) {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // Waves effect (optimized - fewer waves)
            if (state.visualEffect === 'waves' || state.visualEffect === 'all') {
                ctx.save();
                ctx.strokeStyle = state.color1;
                ctx.lineWidth = 3;
                ctx.globalAlpha = 0.3 + bassLevel * 0.5;
                
                for (let i = 0; i < 2; i++) { // Reduced from 3 to 2
                    const radius = 200 + i * 150 + bassLevel * 150;
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                    ctx.stroke();
                }
                ctx.restore();
            }
            
            // Lightning effect (optimized - only on strong bass)
            if ((state.visualEffect === 'lightning' || state.visualEffect === 'all') && bassLevel > 0.6) {
                ctx.save();
                ctx.strokeStyle = state.color2;
                ctx.lineWidth = 4;
                ctx.globalAlpha = bassLevel;
                ctx.shadowColor = state.color2;
                ctx.shadowBlur = 20;
                
                // Random lightning bolts (reduced from 3 to 2)
                for (let i = 0; i < 2; i++) {
                    ctx.beginPath();
                    let x = centerX + (Math.random() - 0.5) * 600;
                    let y = 0;
                    ctx.moveTo(x, y);
                    
                    for (let j = 0; j < 6; j++) { // Reduced from 8 to 6
                        x += (Math.random() - 0.5) * 100;
                        y += canvas.height / 6;
                        ctx.lineTo(x, y);
                    }
                    ctx.stroke();
                }
                ctx.restore();
            }
        }

        function drawOrb(x, y, size, color, opacity) {
            ctx.save();
            const gradient = ctx.createRadialGradient(x, y, 0, x, y, size);
            gradient.addColorStop(0, color + Math.floor(opacity * 255).toString(16).padStart(2, '0'));
            gradient.addColorStop(1, 'transparent');
            ctx.fillStyle = gradient;
            ctx.filter = 'blur(60px)';
            ctx.fillRect(x - size, y - size, size * 2, size * 2);
            ctx.restore();
        }

        // Audio controls
        async function toggleAudio() {
            if (!audioElement.src) {
                showStatus('‚ùå Bitte zuerst Audio hochladen!');
                return;
            }
            
            if (isPlaying) {
                audioElement.pause();
                isPlaying = false;
                document.getElementById('playBtn').textContent = '‚ñ∂';
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
                render();
            } else {
                try {
                    // Resume audio context if suspended
                    if (audioContext && audioContext.state === 'suspended') {
                        await audioContext.resume();
                    }
                    
                    // Play audio
                    await audioElement.play();
                    isPlaying = true;
                    document.getElementById('playBtn').textContent = '‚è∏';
                    
                    // Start animation if reactive mode is on
                    if (state.enableReactive) {
                        render();
                    }
                    
                    showStatus('‚ñ∂ Audio l√§uft...');
                    
                } catch (error) {
                    console.error('Play error:', error);
                    showStatus('‚ùå Fehler beim Abspielen: ' + error.message);
                    isPlaying = false;
                    document.getElementById('playBtn').textContent = '‚ñ∂';
                }
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Export functions
        function downloadImage() {
            // Stop animation temporarily if video is playing
            const wasAnimating = animationId !== null;
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            // Render one final frame
            render();
            
            canvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `WIHB_${state.text1}_${state.text2}_Thumbnail.png`;
                a.click();
                URL.revokeObjectURL(url);
                
                showStatus('‚úÖ PNG gespeichert!');
                
                // Resume animation if it was running
                if (wasAnimating) {
                    render();
                }
            });
        }

        async function recordVideo() {
            if (!audioElement.src) {
                showStatus('‚ùå Bitte zuerst Audio hochladen!');
                return;
            }
            
            if (!audioContext) {
                showStatus('‚ùå Bitte Audio erst einmal abspielen bevor du aufnimmst!');
                return;
            }
            
            const recordBtn = document.getElementById('recordBtn');
            
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                // Stop recording
                mediaRecorder.stop();
                audioElement.pause();
                isPlaying = false;
                document.getElementById('playBtn').textContent = '‚ñ∂';
                recordBtn.textContent = 'üé¨ Als MP4 aufnehmen (mit Audio)';
                recordBtn.classList.remove('secondary');
                showStatus('‚è≥ Video wird verarbeitet...');
                return;
            }
            
            // Start recording
            recordedChunks = [];
            
            try {
                // Create stream from canvas
                const canvasStream = canvas.captureStream(30); // 30 FPS
                
                // Get audio stream
                const audioDestination = audioContext.createMediaStreamDestination();
                if (audioSource) {
                    audioSource.connect(audioDestination);
                }
                
                // Combine streams
                const combinedStream = new MediaStream([
                    ...canvasStream.getVideoTracks(),
                    ...audioDestination.stream.getAudioTracks()
                ]);
                
                mediaRecorder = new MediaRecorder(combinedStream, {
                    mimeType: 'video/webm;codecs=vp9,opus',
                    videoBitsPerSecond: 8000000
                });
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `WIB_${state.text1}_${state.text2}_Video.webm`;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    showStatus('‚úÖ Video gespeichert! (WebM Format - kann in MP4 konvertiert werden)');
                };
                
                mediaRecorder.start();
                
                // Start audio
                audioElement.currentTime = 0;
                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                }
                await audioElement.play();
                isPlaying = true;
                document.getElementById('playBtn').textContent = '‚è∏';
                
                // Start rendering
                state.enableReactive = true;
                document.getElementById('enableReactive').checked = true;
                render();
                
                recordBtn.textContent = '‚èπ Aufnahme stoppen';
                recordBtn.classList.add('secondary');
                showStatus('üî¥ Aufnahme l√§uft...');
                
                // Auto-stop when audio ends
                audioElement.onended = () => {
                    if (mediaRecorder && mediaRecorder.state === 'recording') {
                        mediaRecorder.stop();
                        isPlaying = false;
                        document.getElementById('playBtn').textContent = '‚ñ∂';
                        recordBtn.textContent = 'üé¨ Als MP4 aufnehmen (mit Audio)';
                        recordBtn.classList.remove('secondary');
                    }
                };
                
            } catch (error) {
                console.error('Recording error:', error);
                showStatus('‚ùå Aufnahme-Fehler: ' + error.message);
            }
        }

        function showStatus(message) {
            const statusMsg = document.getElementById('statusMsg');
            statusMsg.textContent = message;
            statusMsg.style.display = 'block';
            setTimeout(() => {
                statusMsg.style.display = 'none';
            }, 4000);
        }

        // Presets
        const presets = {
            drill: {
                color1: '#ff0844',
                color2: '#ff5e3a',
                text1: 'DRILL',
                text2: 'BALKAN',
                textColor1: '#ffffff',
                textColor2: '#ffffff',
                badge: 'FREE',
                bpm: 140,
                year: 2025
            },
            trap: {
                color1: '#9d00ff',
                color2: '#ff00ff',
                text1: 'TRAP',
                text2: 'BEAT',
                textColor1: '#ffffff',
                textColor2: '#ffffff',
                badge: 'FREE',
                bpm: 145,
                year: 2025
            },
            melodic: {
                color1: '#00d4ff',
                color2: '#7b2cbf',
                text1: 'MELODIC',
                text2: 'VIBES',
                textColor1: '#ffffff',
                textColor2: '#ffffff',
                badge: 'FREE',
                bpm: 130,
                year: 2025
            },
            aggressive: {
                color1: '#ff0000',
                color2: '#000000',
                text1: 'HARD',
                text2: 'BEAT',
                textColor1: '#ffffff',
                textColor2: '#ff0000',
                badge: 'NEW',
                bpm: 150,
                year: 2025
            },
            balkan: {
                color1: '#ff0000',
                color2: '#0066ff',
                text1: 'DRILL',
                text2: 'BALKAN',
                textColor1: '#ffffff',
                textColor2: '#ffffff',
                badge: 'FREE',
                bpm: 140,
                year: 2025
            },
            dark: {
                color1: '#1a1a1a',
                color2: '#4a4a4a',
                text1: 'DARK',
                text2: 'BEAT',
                textColor1: '#ffffff',
                textColor2: '#999999',
                badge: 'NEW',
                bpm: 135,
                year: 2025
            }
        };

        function applyPreset(name) {
            const preset = presets[name];
            
            document.getElementById('color1').value = preset.color1;
            document.getElementById('color2').value = preset.color2;
            document.getElementById('text1').value = preset.text1;
            document.getElementById('text2').value = preset.text2;
            document.getElementById('textColor1').value = preset.textColor1;
            document.getElementById('textColor2').value = preset.textColor2;
            document.getElementById('badge').value = preset.badge;
            document.getElementById('bpm').value = preset.bpm;
            document.getElementById('year').value = preset.year;
            
            state.color1 = preset.color1;
            state.color2 = preset.color2;
            state.text1 = preset.text1;
            state.text2 = preset.text2;
            state.textColor1 = preset.textColor1;
            state.textColor2 = preset.textColor2;
            state.badge = preset.badge;
            state.bpm = preset.bpm;
            state.year = preset.year;
            
            render();
        }

        // Initial render - call after DOM is ready
        window.addEventListener('load', () => {
            render(performance.now());
        });
    </script>
</body>
</html>
